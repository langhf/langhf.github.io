<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="Drelang" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/uploads/avatar.jpg?v=5.1.1">






<meta name="description" content="Recording my study.">
<meta property="og:type" content="website">
<meta property="og:title" content="Drelang">
<meta property="og:url" content="http://www.drelang.cn/page/2/index.html">
<meta property="og:site_name" content="Drelang">
<meta property="og:description" content="Recording my study.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Drelang">
<meta name="twitter:description" content="Recording my study.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.drelang.cn/page/2/">





  <title>Drelang</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-93100231-1', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Drelang</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/10/14/sql插入数据已经存在，则执行update更新/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/14/sql插入数据已经存在，则执行update更新/" itemprop="url">sql插入数据已经存在，则执行update更新</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-14T00:00:00+08:00">
                2018-10-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/14/sql插入数据已经存在，则执行update更新/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/10/14/sql插入数据已经存在，则执行update更新/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址：<a href="http://www.111cn.net/database/mysql/76509.htm" target="_blank" rel="noopener">http://www.111cn.net/database/mysql/76509.htm</a></p>
<p>总结下，最好用的语法应该如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">replace</span> <span class="keyword">into</span> testtb(<span class="keyword">id</span>,<span class="keyword">name</span>,age)<span class="keyword">values</span>(<span class="number">1</span>,<span class="string">"aa"</span>,<span class="number">12</span>);</span><br></pre></td></tr></table></figure></p>
<p>其中 testtb 为表名，id为主键，一定要设置主键。如果上述记录不存在，则插入该条新纪录；如果上述记录存在，则更新该记录.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/10/10/MySQL 5.7 添加用户，授权，删除用户/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/10/MySQL 5.7 添加用户，授权，删除用户/" itemprop="url">MySQL 5.7 添加用户，授权，删除用户</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-10T00:00:00+08:00">
                2018-10-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/10/MySQL 5.7 添加用户，授权，删除用户/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/10/10/MySQL 5.7 添加用户，授权，删除用户/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create user &apos;&lt;USERNAME&gt;&apos;@&apos;&lt;HOST&gt;&apos; identified by &apos;&lt;PASSWORD&gt;&apos;;</span><br></pre></td></tr></table></figure>
<p><strong>USERNAME：</strong>为登录 mysql 的用户名。<br><strong>HOST：</strong>为登录 mysql 的主机地址。如 HOST=localhost 时，只能本地访问；HOST=% 时，任何主机都可以访问，但是要修改文件 /etc/mysql/mysql.conf.d/mysqld.cnf ，注释掉 bind-address = 127.0.0.1；若要指定一定网段的 HOST，则可以将网段设置如下: HOST=192.168.8.% 。<br><strong>PASSWORD</strong>：用 USERNAME 指定的用户的登录密码。</p>
<h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> &lt;DATABASE_NAME&gt; <span class="keyword">default</span> <span class="keyword">charset</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> &lt;DATABASE_NAME&gt;.* <span class="keyword">to</span> <span class="string">'&lt;USERNAME&gt;'</span>@<span class="string">'&lt;HOST&gt;'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'&lt;PASSWORD&gt;'</span>;</span><br></pre></td></tr></table></figure>
<p>以上命令先创建了一个名为 DATABASE_NAME 的数据库，字符集为 utf8。然后将所有权限授予了主机地址为 HOST，用户名为 USERNAME，密码为 PASSWORD 的用户。</p>
<h2 id="删除数据库、用户"><a href="#删除数据库、用户" class="headerlink" title="删除数据库、用户"></a>删除数据库、用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> &lt;DATABASE_NAME&gt;;    <span class="comment">-- 删除数据库</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">'&lt;USERNAME&gt;'</span>@<span class="string">'&lt;HOST&gt;'</span>;  <span class="comment">-- 删除用户</span></span><br></pre></td></tr></table></figure>
<h2 id="查看数据库所有用户、主机地址和密码"><a href="#查看数据库所有用户、主机地址和密码" class="headerlink" title="查看数据库所有用户、主机地址和密码"></a>查看数据库所有用户、主机地址和密码</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host,authentication_string <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
<h2 id="执行-SQL-文件"><a href="#执行-SQL-文件" class="headerlink" title="执行 SQL 文件"></a>执行 SQL 文件</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /path/to/sql_file</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/10/10/nginx luaopenresty 相关资源整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/10/nginx luaopenresty 相关资源整理/" itemprop="url">nginx lua/openresty 相关资源整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-10T00:00:00+08:00">
                2018-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/10/nginx luaopenresty 相关资源整理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/10/10/nginx luaopenresty 相关资源整理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Lua-包管理工具："><a href="#Lua-包管理工具：" class="headerlink" title="Lua 包管理工具："></a>Lua 包管理工具：</h2><p>Lua的包管理工具为 luarocks，在官网 <a href="https://luarocks.org/" target="_blank" rel="noopener">https://luarocks.org/</a> 可以找到各种有用的 lua 包。</p>
<h2 id="openresty-手册："><a href="#openresty-手册：" class="headerlink" title="openresty 手册："></a>openresty 手册：</h2><p><a href="https://www.nginx.com/resources/wiki/modules/lua/" target="_blank" rel="noopener">https://www.nginx.com/resources/wiki/modules/lua/</a></p>
<h2 id="一些有质量的-openresty-的库和资源："><a href="#一些有质量的-openresty-的库和资源：" class="headerlink" title="一些有质量的 openresty 的库和资源："></a>一些有质量的 openresty 的库和资源：</h2><p>参看 Github 上别人的整理  <a href="https://github.com/bungle/awesome-resty#authentication-and-authorization" target="_blank" rel="noopener">https://github.com/bungle/awesome-resty#authentication-and-authorization</a></p>
<p>##相关书籍：</p>
<ol>
<li>《深入理解 Nginx：模块开发与架构解析》第二版，陶辉 著。</li>
<li>《Nginx Lua 开发实战》，李明江 著。</li>
</ol>
<p>持续更新。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/09/27/openresty1.13 与 nginx+php7.0-fpm 压测对比/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/openresty1.13 与 nginx+php7.0-fpm 压测对比/" itemprop="url">openresty1.13 与 nginx+php7.0-fpm 压测对比</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-27T00:00:00+08:00">
                2018-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/27/openresty1.13 与 nginx+php7.0-fpm 压测对比/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/27/openresty1.13 与 nginx+php7.0-fpm 压测对比/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>为了验证下 openresty 官网所说的比 nginx+php-fpm 的吞吐量要高，因此做了以下测试，本次测试服务器硬件配置如下:</p>
<p>Dell latitude 3330</p>
<p>CPU: 4 core  Intel(R) Core(TM) i5-3337U CPU @ 1.80GHz</p>
<p>MEM: 8GB</p>
<p>本次测试两种架构下，服务器都发送 “Hello,world!” 这一字符串。</p>
<h2 id="1-100并发，50k请求"><a href="#1-100并发，50k请求" class="headerlink" title="1. 100并发，50k请求"></a>1. 100并发，50k请求</h2><p>以下为 openresty 的压测结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ab -c 100 -n 50000 -q http://192.168.8.156:8090/</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 192.168.8.156 (be patient).....<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        openresty/1.13.6.2</span><br><span class="line">Server Hostname:        192.168.8.156</span><br><span class="line">Server Port:            8090</span><br><span class="line"></span><br><span class="line">Document Path:          /</span><br><span class="line">Document Length:        20 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      100</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   2.743 seconds</span><br><span class="line">Complete requests:      50000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Total transferred:      8400000 bytes</span><br><span class="line">HTML transferred:       1000000 bytes</span><br><span class="line">Requests per second:    18226.60 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       5.486 [ms] (mean)</span><br><span class="line">Time per request:       0.055 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          2990.30 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        1    2   0.6      2       5</span><br><span class="line">Processing:     1    3   0.7      3      10</span><br><span class="line">Waiting:        1    2   0.6      2      10</span><br><span class="line">Total:          4    5   0.5      5      15</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%      5</span><br><span class="line">  66%      6</span><br><span class="line">  75%      6</span><br><span class="line">  80%      6</span><br><span class="line">  90%      6</span><br><span class="line">  95%      6</span><br><span class="line">  98%      6</span><br><span class="line">  99%      7</span><br><span class="line"> 100%     15 (longest request)</span><br></pre></td></tr></table></figure></p>
<p>以下为 nginx+php7.0-fpm 的压测结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ab -c 100 -n 50000 -q http://192.168.8.156:8080/test.php</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 192.168.8.156 (be patient).....<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        nginx/1.15.3</span><br><span class="line">Server Hostname:        192.168.8.156</span><br><span class="line">Server Port:            8080</span><br><span class="line"></span><br><span class="line">Document Path:          /test.php</span><br><span class="line">Document Length:        13 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      100</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   3.380 seconds</span><br><span class="line">Complete requests:      50000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Total transferred:      7500000 bytes</span><br><span class="line">HTML transferred:       650000 bytes</span><br><span class="line">Requests per second:    14791.25 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       6.761 [ms] (mean)</span><br><span class="line">Time per request:       0.068 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          2166.69 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0    1   0.6      0       5</span><br><span class="line">Processing:     2    6   1.2      6      14</span><br><span class="line">Waiting:        1    6   1.3      6      14</span><br><span class="line">Total:          4    7   1.1      6      15</span><br><span class="line">WARNING: The median and mean <span class="keyword">for</span> the initial connection time are not within a normal deviation</span><br><span class="line">        These results are probably not that reliable.</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%      6</span><br><span class="line">  66%      7</span><br><span class="line">  75%      7</span><br><span class="line">  80%      8</span><br><span class="line">  90%      8</span><br><span class="line">  95%      9</span><br><span class="line">  98%     10</span><br><span class="line">  99%     11</span><br><span class="line"> 100%     15 (longest request)</span><br></pre></td></tr></table></figure></p>
<h2 id="2-1k并发，50k请求"><a href="#2-1k并发，50k请求" class="headerlink" title="2. 1k并发，50k请求"></a>2. 1k并发，50k请求</h2><p>以下为 openresty 的压测结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ab -c 1000 -n 50000 -q http://192.168.8.156:8090/       </span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 192.168.8.156 (be patient).....done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        openresty/1.13.6.2</span><br><span class="line">Server Hostname:        192.168.8.156</span><br><span class="line">Server Port:            8090</span><br><span class="line"></span><br><span class="line">Document Path:          /</span><br><span class="line">Document Length:        20 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken for tests:   3.445 seconds</span><br><span class="line">Complete requests:      50000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Total transferred:      8400000 bytes</span><br><span class="line">HTML transferred:       1000000 bytes</span><br><span class="line">Requests per second:    14514.61 [#/sec] (mean)</span><br><span class="line">Time per request:       68.896 [ms] (mean)</span><br><span class="line">Time per request:       0.069 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          2381.30 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:       10   24  22.2     23    1030</span><br><span class="line">Processing:     7   35  30.5     33     772</span><br><span class="line">Waiting:        5   27  30.7     25     771</span><br><span class="line">Total:         27   58  37.1     57    1057</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%     57</span><br><span class="line">  66%     60</span><br><span class="line">  75%     61</span><br><span class="line">  80%     62</span><br><span class="line">  90%     63</span><br><span class="line">  95%     64</span><br><span class="line">  98%     67</span><br><span class="line">  99%     75</span><br><span class="line"> 100%   1057 (longest request)</span><br></pre></td></tr></table></figure></p>
<p>以下为 nginx+php7.0-fpm 的压测结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ab -c 1000 -n 50000 -q http://192.168.8.156:8080/test.php</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 192.168.8.156 (be patient).....<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        nginx/1.15.3</span><br><span class="line">Server Hostname:        192.168.8.156</span><br><span class="line">Server Port:            8080</span><br><span class="line"></span><br><span class="line">Document Path:          /test.php</span><br><span class="line">Document Length:        13 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   5.165 seconds</span><br><span class="line">Complete requests:      50000</span><br><span class="line">Failed requests:        14407</span><br><span class="line">   (Connect: 0, Receive: 0, Length: 14407, Exceptions: 0)</span><br><span class="line">Non-2xx responses:      14407</span><br><span class="line">Total transferred:      14962826 bytes</span><br><span class="line">HTML transferred:       7579767 bytes</span><br><span class="line">Requests per second:    9680.80 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       103.297 [ms] (mean)</span><br><span class="line">Time per request:       0.103 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          2829.14 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        7   28 114.9     14    1043</span><br><span class="line">Processing:     7   34  64.3     23    2021</span><br><span class="line">Waiting:        7   31  64.2     20    2021</span><br><span class="line">Total:         14   62 133.9     37    3028</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%     37</span><br><span class="line">  66%     42</span><br><span class="line">  75%     46</span><br><span class="line">  80%     48</span><br><span class="line">  90%     57</span><br><span class="line">  95%     72</span><br><span class="line">  98%    387</span><br><span class="line">  99%   1034</span><br><span class="line"> 100%   3028 (longest request)</span><br></pre></td></tr></table></figure></p>
<h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h2><table>
<thead>
<tr>
<th>并发情况</th>
<th>吞吐量</th>
<th>平均完成时间</th>
<th>90%完成时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>c100 n50k</td>
<td>18226.6/14791.25</td>
<td>5/7</td>
<td>6/8</td>
</tr>
<tr>
<td>c1k  n50k</td>
<td>14514.61/9680.80</td>
<td>58/62</td>
<td>63/57</td>
</tr>
</tbody>
</table>
<p>​<br>以上数据对比格式为： openresty/nginx+php7.0-fpm</p>
<p>从上面对比情况可以看出，openresty 在并发情况下吞吐量的确要比 nginx+php7.0-fpm 高。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/09/13/Linux 查看 cpu, mem, disk 和 network 信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/13/Linux 查看 cpu, mem, disk 和 network 信息/" itemprop="url">Linux 查看 cpu, mem, disk 和 network 信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-13T00:00:00+08:00">
                2018-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/13/Linux 查看 cpu, mem, disk 和 network 信息/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/13/Linux 查看 cpu, mem, disk 和 network 信息/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于一个 Linux 服务器来说，cpu 的主频以及占用率，内存的大小以及占用率，磁盘 I/O 速率和网卡 I/O 速率极大地影响着服务器的性能。在 Linux 系统下，开发者提供了/proc 文件系统来提供系统相关的进程信息</p>
<h2 id="1-查看-cpu-主频和占用率"><a href="#1-查看-cpu-主频和占用率" class="headerlink" title="1.查看 cpu 主频和占用率"></a>1.查看 cpu 主频和占用率</h2><p>Linux 下 CPU 的主频有两种获取方式，一种是通过读取 /proc/cpuinfo 文件，另外一种是利用 CPU 主频的计算原理编写程序获取。此处只介绍前一种方式。即使用命令 cat /proc/cpuinfo 。从下方图片可以看到，本人的电脑是双核 CPU，主频都为 2.60GHz。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Lance<span class="comment"># cat /proc/cpuinfo</span></span><br><span class="line">processor       : 0</span><br><span class="line">vendor_id       : GenuineIntel</span><br><span class="line">cpu family      : 6</span><br><span class="line">model           : 23</span><br><span class="line">model name      : Pentium(R) Dual-Core  CPU      E5300  @ 2.60GHz</span><br><span class="line">stepping        : 10</span><br><span class="line">microcode       : 0xa0b</span><br><span class="line">cpu MHz         : 1200.000</span><br><span class="line">cache size      : 2048 KB</span><br><span class="line">physical id     : 0</span><br><span class="line">siblings        : 2</span><br><span class="line">core id         : 0</span><br><span class="line">cpu cores       : 2</span><br><span class="line">apicid          : 0</span><br><span class="line">initial apicid  : 0</span><br><span class="line">fpu             : yes</span><br><span class="line">fpu_exception   : yes</span><br><span class="line">cpuid level     : 13</span><br><span class="line">wp              : yes</span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm xsave lahf_lm pti tpr_shadow vnmi flexpriority dtherm</span><br><span class="line">bugs            : cpu_meltdown spectre_v1 spectre_v2</span><br><span class="line">bogomips        : 5186.86</span><br><span class="line">clflush size    : 64</span><br><span class="line">cache_alignment : 64</span><br><span class="line">address sizes   : 36 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line"></span><br><span class="line">processor       : 1</span><br><span class="line">vendor_id       : GenuineIntel</span><br><span class="line">cpu family      : 6</span><br><span class="line">model           : 23</span><br><span class="line">model name      : Pentium(R) Dual-Core  CPU      E5300  @ 2.60GHz</span><br><span class="line">stepping        : 10</span><br><span class="line">microcode       : 0xa0b</span><br><span class="line">cpu MHz         : 1200.000</span><br><span class="line">cache size      : 2048 KB</span><br><span class="line">physical id     : 0</span><br><span class="line">siblings        : 2</span><br><span class="line">core id         : 1</span><br><span class="line">cpu cores       : 2</span><br><span class="line">apicid          : 1</span><br><span class="line">initial apicid  : 1</span><br><span class="line">fpu             : yes</span><br><span class="line">fpu_exception   : yes</span><br><span class="line">cpuid level     : 13</span><br><span class="line">wp              : yes</span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm xsave lahf_lm pti tpr_shadow vnmi flexpriority dtherm</span><br><span class="line">bugs            : cpu_meltdown spectre_v1 spectre_v2</span><br><span class="line">bogomips        : 5186.86</span><br><span class="line">clflush size    : 64</span><br><span class="line">cache_alignment : 64</span><br><span class="line">address sizes   : 36 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br></pre></td></tr></table></figure></p>
<p>Linux 下 CPU 的使用状态可分为用户态、系统态以及空闲态。CPU 占用率可以用如下公式计算</p>
<pre><code>CPU占用率 = CPU执行非系统空闲进程时间/CPU执行总时间
</code></pre><p>/proc/stat 文件对 CPU 的使用情况进行了实时的记录，如下图所示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Lance<span class="comment"># cat /proc/stat</span></span><br><span class="line">cpu  525228 16439 390034 139932703 224352 0 2010 0 0 0</span><br><span class="line">cpu0 265224 6822 197250 70017169 60063 0 74 0 0 0</span><br><span class="line">cpu1 260004 9617 192784 69915534 164289 0 1936 0 0 0</span><br><span class="line">intr 126884204 43 2 0 0 0 0 0 1 0 3 0 0 4 0 0 0 124 0 2 1404563 0 0 0 0 955106 514 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">ctxt 193899569</span><br><span class="line">btime 1536131324</span><br><span class="line">processes 268172</span><br><span class="line">procs_running 1</span><br><span class="line">procs_blocked 0</span><br><span class="line">softirq 101783843 10 36600014 116255 1002291 1058479 0 263 35993177 0 27013354</span><br></pre></td></tr></table></figure></p>
<p>其中首行的 10 个参数含义如下：</p>
<pre><code>user    nice    system  idle    iowait  irq softirq steal   guest   guest_nice
user:用户态的CPU时间
nice：低优先级程序所占用的用户态的cpu时间。
system：系统态的CPU时间
idle：CPU空闲的时间
iowait：等待IO响应的时间
irq：处理硬件中断的时间
softirq：处理软中断的时间
steal: 处理其他所花的时间
guest：运行时间为客户操作系统下的虚拟CPU控制
guest_nice：访客的低优先级程序所占用的用户态的cpu时间
</code></pre><p>余下的参数中：</p>
<pre><code>intr: 第一个参数表示的是自系统启动以来，发生的所有中断的次数；其他的数对应一个特定中断发生的次数

ctxt: cpu自系统启动以来发生的上下文交换次数

btime: 系统启动到现在的时间 UTC 秒

processes: 表示系统启动以来创建的进程个数

procs_running: 当前运行进程的个数

procs_blocked: 当前被阻塞的进程个数

softirq: 显示软中断情况
</code></pre><p>要计算 CPU 在某段时间内的占用率，可以分别记录下 t1 和 t2 时刻的 CPU 总的状态和空闲状态，因此：</p>
<pre><code>CPU占用率 = 1 - ( idle2 - idle1 ) / (total2 - total1)
</code></pre><p>其中 total 表示 10 个参数之和。</p>
<h2 id="2-查看内存大小及占用率"><a href="#2-查看内存大小及占用率" class="headerlink" title="2. 查看内存大小及占用率"></a>2. 查看内存大小及占用率</h2><p>/proc/meminfo 记录了内存信息。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Lance<span class="comment"># cat /proc/meminfo</span></span><br><span class="line">MemTotal:        4003752 kB</span><br><span class="line">MemFree:          517464 kB</span><br><span class="line">MemAvailable:    3144816 kB</span><br><span class="line">Buffers:          257152 kB</span><br><span class="line">Cached:          2289308 kB</span><br><span class="line">SwapCached:            0 kB</span><br><span class="line">Active:          1455916 kB</span><br><span class="line">Inactive:        1487740 kB</span><br><span class="line">Active(anon):     277376 kB</span><br><span class="line">Inactive(anon):   174624 kB</span><br><span class="line">Active(file):    1178540 kB</span><br><span class="line">Inactive(file):  1313116 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:       6253564 kB</span><br><span class="line">SwapFree:        6253564 kB</span><br><span class="line">Dirty:                 8 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        395168 kB</span><br><span class="line">Mapped:           207872 kB</span><br><span class="line">Shmem:             54808 kB</span><br><span class="line">Slab:             460364 kB</span><br><span class="line">SReclaimable:     425200 kB</span><br><span class="line">SUnreclaim:        35164 kB</span><br><span class="line">KernelStack:        5376 kB</span><br><span class="line">PageTables:        22064 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:     8255440 kB</span><br><span class="line">Committed_AS:    2553704 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:           0 kB</span><br><span class="line">VmallocChunk:          0 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:      2048 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">ShmemPmdMapped:        0 kB</span><br><span class="line">CmaTotal:              0 kB</span><br><span class="line">CmaFree:               0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">DirectMap4k:      113216 kB</span><br><span class="line">DirectMap2M:     4044800 kB</span><br></pre></td></tr></table></figure></p>
<p>其中：</p>
<pre><code>MemTotal：表示系统可支配内存
MemAvailable：表示应用程序可用的内存
</code></pre><p>因此，内存占用率可以用如下公式计算：</p>
<h2 id="3-查看磁盘-I-O占用率"><a href="#3-查看磁盘-I-O占用率" class="headerlink" title="3.查看磁盘 I/O占用率"></a>3.查看磁盘 I/O占用率</h2><p>安装 sysstat 工具，它的子工具 iostat 可以显示 I/O 占用率。%util 参数表示 1s内用于 I/O 请求所用时间的比例，%util 值越高，I/O 占用率越高，可直接使用这个参数来代表 I/O 占用率<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Lance<span class="comment"># iostat -x</span></span><br><span class="line">Linux 4.13.0-32-generic (Lance)         2018年09月13日  _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.37    0.01    0.28    0.16    0.00   99.17</span><br><span class="line"></span><br><span class="line">Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util</span><br><span class="line">loop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00   21.41    0.00   0.00     2.44     0.00  20.89   0.00</span><br><span class="line">loop1            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00   44.62    0.00   0.00     1.69     0.00  11.38   0.00</span><br><span class="line">loop2            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00   19.93    0.00   0.00     9.65     0.00  12.31   0.00</span><br><span class="line">loop3            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00   41.81    0.00   0.00    14.23     0.00  18.88   0.00</span><br><span class="line">loop4            0.01    0.00      0.01      0.00     0.00     0.00   0.00   0.00    6.61    0.00   0.00     1.12     0.00   0.50   0.00</span><br><span class="line">loop5            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     1.60     0.00   0.00   0.00</span><br><span class="line">sda              0.24    0.52      3.45     14.18     0.17     0.56  41.05  51.90    3.56   31.99   0.02    14.40    27.51   4.51   0.34</span><br></pre></td></tr></table></figure></p>
<h2 id="4-查看网络带宽使用率"><a href="#4-查看网络带宽使用率" class="headerlink" title="4. 查看网络带宽使用率"></a>4. 查看网络带宽使用率</h2><p>/proc/net/dev 文件中记录了网络相关的使用情况，其中分别记录了发送和接收的数据包总数、收发的错误包数以及收发的丢失包数等。取单位时间内发送和接收的数据包总包数(totalPackets)，除以网络的基本带宽（bandWidth）:<br>                                  pnet = 100%*totalPackets/bandWidth</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Lance<span class="comment"># cat /proc/net/dev</span></span><br><span class="line">Inter-|   Receive                                                |  Transmit</span><br><span class="line"> face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed</span><br><span class="line">    lo: 2729345   46942    0    0    0     0          0         0  2729345   46942    0    0    0     0       0          0</span><br><span class="line">enp2s0: 558026941  723202    0 11733    0     0          0    105753 23827630  275738    0    0    0     0       0          0</span><br></pre></td></tr></table></figure>
<pre><code>bytes: 接口发送或接收的总字节数
packets: 接口发送或接收的总数据包数
errs: 有设备驱动程序检测到的发送或者接收错误的总数
drop: 设备驱动程序丢弃的数据包总数
fifo: FIFO 缓冲区错误的数量
frame: 分组帧错误的数量
colls: 接口上检测到的冲突数
compressed: 设备驱动程序发送或接收的压缩数据包数
carrier: 由设备驱动程序检测到的载波损耗的数量
multicast: 设备驱动程序发送或接收的多播帧数
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/09/12/CentOS 从源码编译并安装 Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/12/CentOS 从源码编译并安装 Nginx/" itemprop="url">CentOS 从源码编译并安装 Nginx</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-12T00:00:00+08:00">
                2018-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/12/CentOS 从源码编译并安装 Nginx/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/12/CentOS 从源码编译并安装 Nginx/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Linux-系统要求"><a href="#Linux-系统要求" class="headerlink" title="Linux 系统要求"></a>Linux 系统要求</h2><p>Nginx 在 Linux 操作系统下运行的时候，要想获取高并发能力，要求 Linux 内核必须在 2.6 以上，可通过以下命令查看 Linux 内核版本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">2.6.18-128.e15</span><br></pre></td></tr></table></figure></p>
<h2 id="安装-Nginx-的必备软件"><a href="#安装-Nginx-的必备软件" class="headerlink" title="安装 Nginx 的必备软件"></a>安装 Nginx 的必备软件</h2><p>通过以下命令安装使用 Nginx 必备的软件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum update</span><br><span class="line">$ sudo yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure></p>
<p>其中：</p>
<ol>
<li>gcc 和 gcc-c++ 为 c/c++ 编译器</li>
<li>PCRE 即 Perl 兼容正则表达式，如果我们在 nginx.conf 中使用到了正则表达式，那么必须在编译时将 pcre 库编译进 Nginx。pcre-devel 是使用 PCRE 做二次开发时所需要的开发库，包括头文件，这也是编译时所必需的。</li>
<li>lib 库用于对 HTTP 包的内容做 gzip 格式的压缩。zlib-devel 是二次开发所需要的库。</li>
<li>open-ssl 用来支持 SSL。<h2 id="编译与安装"><a href="#编译与安装" class="headerlink" title="编译与安装"></a>编译与安装</h2>从 Nginx 官网  <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">https://nginx.org/en/download.html</a> 下载最新的 Nginx 源码，放在任意目录下，然后解压<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xf nginx-1.xx.0.tar.gz</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>进入解压后文件夹，执行以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure</span><br><span class="line">$ make </span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure></p>
<p>其中，./configure 用来生成 make 所必须的一些文件。Nginx 安装完成后的目录默认在 /usr/local/nginx 。</p>
<h2 id="优化-Linux-内核参数"><a href="#优化-Linux-内核参数" class="headerlink" title="优化 Linux 内核参数"></a>优化 Linux 内核参数</h2><p>默认的 Linux　内核参数不符合用于支持高并发访问的 web 服务器的定义，因此需要优化内核参数，需要修改 /etc/sysctl.conf 文件，常用配置如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max = 999999              # 进程可以同时打开的最大句柄数，直接限制最大并发连接数</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1         # １表示允许将　TIME-WAIT 状态的 socket 重新用于新的 TCP 链接</span><br><span class="line">net.ipv4.tcp_keepalive_time = 600 # 启用 keepalive 时，TCP 发送 keepalive 消息的频度</span><br><span class="line">net.ipv4.tcp_fin_timeout 30       # 服务器主动关闭连接时，socket 保持在 FIN-WAIT-2 状态的时间 </span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 5000          # TIME-WAIT 套接字数量的最大值</span><br><span class="line">net.ipv4.ip_local_port_range = 1024  61000  # UDP 和 TCP 连接中本地端口取值范围</span><br><span class="line">net.ipv4.tcp_rmem = 4096 32768 262142       # TCP 接收缓存的最小值，默认值，最大值</span><br><span class="line">net.ipv4.tcp_wmem = 4096 32768 262142       # TCP 发送缓存的最小值，默认值，最大值</span><br><span class="line">net.core.netdev_max_backlog = 8096          # 当网卡接收数据包的速度大于内核处理速度时，会有一个队列保存这些数据包，该参数表示该队列的最大值</span><br><span class="line">net.core.rmem_default = 262144    # 内核套接字接收缓存区默认的大小</span><br><span class="line">net.core.wmem_default = 262144    # 内核套接字发送缓存区默认的大小</span><br><span class="line">net.core.rmem_max = 2097152       # 内核套接字接收缓存区的最大大小</span><br><span class="line">net.core.wmem_max = 2097152       # 内核套接字发送缓存区的最大大小</span><br><span class="line">net.tcp_syncookies = 1            # 该参数与性能无关，用于解决 TCP 的 SYN 攻击 </span><br><span class="line">net.tcp_max_syn.backlog = 1024    # TCP 三次握手接收 SYN 请求队列的最大长度</span><br></pre></td></tr></table></figure></p>
<p>然后执行 sysctl -p 即可使上述命令生效。</p>
<p>参考书籍：《深入理解 Nginx：模块开发与架构解析》第二版。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/09/11/Ubuntu 16.04 引导修复（boot-repair）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/11/Ubuntu 16.04 引导修复（boot-repair）/" itemprop="url">Ubuntu 16.04 引导修复（boot-repair）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-11T00:00:00+08:00">
                2018-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/折腾/" itemprop="url" rel="index">
                    <span itemprop="name">折腾</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/11/Ubuntu 16.04 引导修复（boot-repair）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/11/Ubuntu 16.04 引导修复（boot-repair）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文转载自：<a href="https://blog.csdn.net/laocaibcc229/article/details/79274412" target="_blank" rel="noopener">https://blog.csdn.net/laocaibcc229/article/details/79274412</a></p>
<h2 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h2><p>在win10的基础上安装了ubuntu16.04，但是后来重新安装了win10，导致ubuntu的引导消失。查找了多种方法，包括easyBCD，rEFind与bootice等，都没有成功，最终用U盘启动盘进行修复，解决了这个问题。</p>
<h2 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h2><p>1.制作一个U盘启动盘。下载对应的ubuntu系统，用UltraISO制作Ubuntu U盘启动。</p>
<p>2.打开电脑后选择u盘启动盘，然后选择try ubuntu without install。试用不安装。</p>
<p>3.进入ubuntu系统后，连接好网络，打开终端，输入下面命令，按照提示操作。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:yannubuntu/boot-repair &amp;&amp; sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>4.完成后，终端中输入下面命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y boot-repair &amp;&amp; boot-repair</span><br></pre></td></tr></table></figure></p>
<p>会出现如下界面，选择recommended repair</p>
<p><img src="./images/boot-repair-1.png" alt="boot-repair-1"></p>
<p>5.按照boot repair提示的操作进行，完成后重启电脑即可完成。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/09/08/加权法排序二值序列所记录的对象集/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/08/加权法排序二值序列所记录的对象集/" itemprop="url">加权法排序二值序列所记录的对象集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-08T00:00:00+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/08/加权法排序二值序列所记录的对象集/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/08/加权法排序二值序列所记录的对象集/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>给定一串 6 位 0-1 序列， 如 ‘111111’，该序列记录着集合内 A, B, C, D 四个元素的大小。其中每一个比特的含义如下：</p>
<p>第 1 位，表示 A 与 B 的大小关系，为 0 表示 A&lt;B， 为 1 表示 A&gt;B;</p>
<p>第 2 位，表示 B 与 C 的大小关系，为 0 表示 B&lt;C， 为 1 表示 B&gt;C;</p>
<p>第 3 位，表示 C 与 D 的大小关系，为 0 表示 C&lt;D， 为 1 表示 C&gt;D;</p>
<p>第 4 位，表示 A 与 C 的大小关系，为 0 表示 A&lt;C， 为 1 表示 A&gt;C;</p>
<p>第 5 位，表示 B 与 D 的大小关系，为 0 表示 B&lt;D， 为 1 表示 B&gt;D;</p>
<p>第 6 位，表示 A 与 D 的大小关系，为 0 表示 A&lt;D， 为 1 表示 A&gt;D;</p>
<p>根据给定的 0-1 序列，将 A, B, C, D 四个对象按升序排列。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>可以使用加权法，四个对象的初始权重都赋值为 0，依次判断序列中的每一位值，根据值来给相应的较大对象加权。例如，对于序列 ‘111111’，第 1 位为 1，则对象 B 权重加 1，第 2 位为 1， 则对象 C 权重加 1；以此类推；最后对象 A, B, C, D 的权重分别为 0, 1, 2, 3 ， 根据这个权重就可以给四个对象排序了！</p>
<h2 id="代码如下"><a href="#代码如下" class="headerlink" title="代码如下"></a>代码如下</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> tags[<span class="number">6</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; <span class="number">1</span>, <span class="number">2</span> &#125;,</span><br><span class="line">	&#123; <span class="number">2</span>, <span class="number">3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">2</span> &#125;,</span><br><span class="line">	&#123; <span class="number">1</span>, <span class="number">3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0</span>, <span class="number">3</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">sort</span><span class="params">(<span class="keyword">char</span> *series, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *data; <span class="comment">// tmpser 用来记录 A,B,C,D 四个对象的权重，初始权重都为 0</span></span><br><span class="line">	<span class="keyword">char</span> tmpser[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(series[i] == <span class="number">0</span>)</span><br><span class="line">			tmpser[tags[i][<span class="number">1</span>]]++;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			tmpser[tags[i][<span class="number">0</span>]]++;</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	data = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*<span class="number">4</span>);</span><br><span class="line">	data[tmpser[<span class="number">0</span>]] = <span class="string">'A'</span>;</span><br><span class="line">	data[tmpser[<span class="number">1</span>]] = <span class="string">'B'</span>;</span><br><span class="line">	data[tmpser[<span class="number">2</span>]] = <span class="string">'C'</span>;</span><br><span class="line">	data[tmpser[<span class="number">3</span>]] = <span class="string">'D'</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> series[<span class="number">6</span>] = &#123; <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> ,<span class="number">1</span> ,<span class="number">1</span> &#125;;</span><br><span class="line">	<span class="keyword">char</span> *data, i;</span><br><span class="line">	data = sort(series, <span class="number">6</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%c "</span>,data[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<p>D C B A</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/07/20/Nginx + Yii2 配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/Nginx + Yii2 配置/" itemprop="url">Nginx + Yii2 配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-20T00:00:00+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/20/Nginx + Yii2 配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/07/20/Nginx + Yii2 配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前写的一个 yii2 应用一直跑在 apache2 上，最近做压测发现 apache2 的并发处理能力的确差了点，于是想到将应用转移到 nginx 上，以下记录整个迁移过程。</p>
<h2 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h2><p>由于本人用的是 ubuntu16.04 ，只要使用以下命令就能快速安装 nginx 了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx -y</span><br></pre></td></tr></table></figure></p>
<p>由于之前本机安装了 apache2，如果在安装的时候报了一大堆错误，那么很有可能是在运行的 apache2 影响到了安装过程，此时需要先停止 apache2 ，可通过以下命令。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service apache2 stop</span><br></pre></td></tr></table></figure></p>
<p>nginx 成功安装后，相关的配置目录在 /etc/nginx 。可以通过以下命令来启动 nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx start</span><br></pre></td></tr></table></figure></p>
<p>此时访问本地 80 端口即可看到 nginx 欢迎页面。</p>
<h2 id="php7-0-fpm-与-nginx"><a href="#php7-0-fpm-与-nginx" class="headerlink" title="php7.0-fpm 与 nginx"></a>php7.0-fpm 与 nginx</h2><p>nginx 与 php-fpm 通信有两种方式，一种是通过 TCP，另外一种是 unix socket 。据说两者在一般情况下没有太大差异，但是在高并发情况下，unix socket 方式性能要优异一些。修改/etc/php/7.0/pool.d/<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a> 相应内容如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen = /run/php/php7.0-fpm.sock</span><br></pre></td></tr></table></figure></p>
<p>因此，在 nginx 的配置文件中就必须要使用相应的方式，配置如下<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">886</span> default_server;</span><br><span class="line">	<span class="attribute">listen</span> [::]:<span class="number">886</span> default_server;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">root</span> /Myweb/yii2/web;</span><br><span class="line">	<span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">	<span class="comment"># rewrite route</span></span><br><span class="line">	<span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">   		<span class="attribute">rewrite</span><span class="regexp"> ^/(.*)</span> /index.php <span class="literal">last</span>;</span><br><span class="line">  	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">		<span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">		<span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">		<span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">		<span class="comment"># include snippets/fastcgi-php.conf;</span></span><br><span class="line">		<span class="attribute">fastcgi_pass</span> unix:/run/php/php7.0-fpm.sock;</span><br><span class="line">        <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上配置，监听 886 端口，服务器根目录为 /Myweb/yii2/web ，对应 yii2 的入口。 fastcgi_pass unix: /run/php/php7.0-fpm.sock 表示使用 unix socket 方式与 php-fpm 通信。 include 的根目录为 /etc/nginx/。</p>
<h2 id="开启-nginx-的路由重写"><a href="#开启-nginx-的路由重写" class="headerlink" title="开启 nginx 的路由重写"></a>开启 nginx 的路由重写</h2><p>以上配置文件中，如下几行起到了开启路由重写的作用。之前看到很多博文说要另写文件去开启路由重写，后来才发现只要在 sever 配置内写入重写规则即可，没必要另外再新建重写文件。<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">   	<span class="attribute">rewrite</span><span class="regexp"> ^/(.*)</span> /index.php <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  rewrite 是路由重写的指令，根据正则表达式的内容，重定向到replacement，结尾是flag标记。</p>
<p> rewrite    <regex>    <replacement>    [flag];</replacement></regex></p>
<p> 关键字      正则        替代内容          flag标记</p>
<p>具体的可参考其他博客。</p>
<p>参考链接：</p>
<p><a href="https://hideonbushtut.github.io/2017/01/27/%E6%80%BB%E7%BB%93Ubuntu%E4%B8%8B%E9%83%A8%E7%BD%B2LNMP%E7%8E%AF%E5%A2%83/" target="_blank" rel="noopener">总结Ubuntu下部署LNMP环境</a></p>
<p><a href="https://www.cnblogs.com/quwaner/p/8193186.html" target="_blank" rel="noopener">Nginx URL重写（rewrite）配置及信息详解</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.drelang.cn/2018/07/19/批量 ab 测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LanceXiong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drelang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/19/批量 ab 测试/" itemprop="url">批量 ab 测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-19T20:36:10+08:00">
                2018-07-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/19/批量 ab 测试/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/07/19/批量 ab 测试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在做服务器压测，想到可以通过 shell 脚本调用压测工具 ab 来进行多次测试。大致的想法是：</p>
<ol>
<li>通过 shell 脚本循环调用 ab 压测工具得到多次压测日志，并分类保存；</li>
<li>通过 shell 脚本循环调用 awk 工具将每个日志中的 90% 时间提取出来。</li>
</ol>
<h2 id="ab-工具"><a href="#ab-工具" class="headerlink" title="ab 工具"></a>ab 工具</h2><p>ab是apache自带的一个很好用的压力测试工具，当安装完apache的时候，就可以在bin下面找到ab。一个简单的 demo 如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c 10 -n 100 -H <span class="string">"Authorization:Bearer nAuhWwS6xea7BcyCfVy5VoKF7MsAHDTtX7ABzN"</span> http://domain/path</span><br></pre></td></tr></table></figure></p>
<p>其中 -c 代表并发数，-n 代表请求数，-H 要发送的 Header。返回结果示例及各参数意义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 101.132.123.35 (be patient).....done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        Apache/2.4.18 # 服务器类型及其版本</span><br><span class="line">Server Hostname:        &lt;Hostname&gt; # 请求的主机名</span><br><span class="line">Server Port:            84 # 端口号</span><br><span class="line"></span><br><span class="line">Document Path:          /v1/door/helps # 请求的路径</span><br><span class="line">Document Length:        1143 bytes # 返回数据的大小</span><br><span class="line"></span><br><span class="line">Concurrency Level:      10 # 并发规模</span><br><span class="line">Time taken for tests:   0.934 seconds # 总请求时间</span><br><span class="line">Complete requests:      100  # 完成的请求数</span><br><span class="line">Failed requests:        0 # 失败的请求数</span><br><span class="line">Total transferred:      131900 bytes # 总共传输的字节数</span><br><span class="line">HTML transferred:       114300 bytes # 总 html 字节数</span><br><span class="line">Requests per second:    107.04 [#/sec] (mean) # 吞吐量</span><br><span class="line">Time per request:       93.427 [ms] (mean) # 用户平均等待时间</span><br><span class="line">Time per request:       9.343 [ms] (mean, across all concurrent requests) # 服务器平均处理时间，即吞吐量倒数</span><br><span class="line">Transfer rate:          137.87 [Kbytes/sec] received # 每秒获取的数据长度</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        7    9   1.2      9      13</span><br><span class="line">Processing:    57   83   9.0     83     119</span><br><span class="line">Waiting:       57   83   9.0     83     119</span><br><span class="line">Total:         67   93   9.4     92     128</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%     92</span><br><span class="line">  66%     95</span><br><span class="line">  75%     96</span><br><span class="line">  80%     99</span><br><span class="line">  90%    105  # 90%的请求在105ms内</span><br><span class="line">  95%    112</span><br><span class="line">  98%    119</span><br><span class="line">  99%    128</span><br><span class="line"> 100%    128 (longest request)</span><br></pre></td></tr></table></figure></p>
<h2 id="shell-脚本多次测试"><a href="#shell-脚本多次测试" class="headerlink" title="shell 脚本多次测试"></a>shell 脚本多次测试</h2><p>一个可多次进行压测的 demo 如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">urlIndex=<span class="string">"http://Hostname/v1/door/helps"</span></span><br><span class="line">Header=<span class="string">"Authorization:Bearer nAuhTiWwS6xea7BcyCfVy5VoKF7MsAHDTtX7ABzN"</span> <span class="comment"># Header</span></span><br><span class="line"><span class="built_in">declare</span> -A concurrent</span><br><span class="line">concurrent=([<span class="string">'c'</span>]=0 [<span class="string">'n'</span>]=100)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..9&#125;;</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="built_in">let</span> concurrent[<span class="string">'c'</span>]+=10; <span class="comment"># shell数值运算</span></span><br><span class="line">    dirName=tests/Getdb/c<span class="variable">$&#123;concurrent['c']&#125;</span>n<span class="variable">$&#123;concurrent['n']&#125;</span>;</span><br><span class="line">    mkdir -p <span class="variable">$dirName</span>;</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> &#123;0..9&#125;;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        outFile=<span class="variable">$&#123;dirName&#125;</span>/<span class="string">"time"</span><span class="variable">$j</span>; </span><br><span class="line">        ab -c <span class="variable">$&#123;concurrent['c']&#125;</span> -n <span class="variable">$&#123;concurrent['n']&#125;</span> -H <span class="string">"<span class="variable">$&#123;Header&#125;</span>"</span>  -e <span class="variable">$&#123;outFile&#125;</span> <span class="variable">$&#123;urlIndex&#125;</span>;</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>要注意的是 shell 进行数值运算时不能对数字直接操作，需要使用 let 命令或者  [] 和 (())  操作符。然后在 mkdir 的时候，最好带上 -p 参数，免得报错。 然后 -H 参数后面带字符串，需要用双引号包起来。</p>
<h2 id="shell-脚本后处理输出日志"><a href="#shell-脚本后处理输出日志" class="headerlink" title="shell 脚本后处理输出日志"></a>shell 脚本后处理输出日志</h2><p>得到的日志目录如下所示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+-- tests</span><br><span class="line">    +-- Get</span><br><span class="line">        +-- c10n100</span><br><span class="line">      	|	+-- time0</span><br><span class="line">      	|	+-- time1</span><br><span class="line">      	|	+-- time2</span><br><span class="line">      	|	+-- time3</span><br><span class="line">      	|	+-- time4</span><br><span class="line">      	|	+-- time5</span><br><span class="line">      	|	+-- time6</span><br><span class="line">      	|	+-- time7</span><br><span class="line">      	|	+-- time8</span><br><span class="line">      	|	+-- time9</span><br><span class="line">    	+-- c20n100</span><br><span class="line">    	+-- c30n100</span><br></pre></td></tr></table></figure></p>
<p>一个个查看日志文件中 90% 用时会显得比较麻烦，于是想到可以用 shell 脚本调用 awk 工具， demo 如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -A concurrent</span><br><span class="line">concurrent=([<span class="string">'c'</span>]=0 [<span class="string">'n'</span>]=100)</span><br><span class="line">fileName=<span class="string">"file.txt"</span> <span class="comment"># 输出文件名</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..9&#125;;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">let</span> concurrent[<span class="string">'c'</span>]+=10;</span><br><span class="line">    dirName=tests/Get/c<span class="variable">$&#123;concurrent['c']&#125;</span>n<span class="variable">$&#123;concurrent['n']&#125;</span> <span class="comment"># 取日志文件</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;dirName&#125;</span> &gt;&gt; <span class="variable">$fileName</span> <span class="comment"># 输出测试条件，一行</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> &#123;0..9&#125;;</span><br><span class="line">    <span class="keyword">do</span>  </span><br><span class="line">        dataFile=<span class="variable">$&#123;dirName&#125;</span>/<span class="string">"time"</span><span class="variable">$j</span>;</span><br><span class="line">        awk <span class="string">'/^90/&#123;print&#125;'</span> <span class="variable">$&#123;dataFile&#125;</span> &gt;&gt; <span class="variable">$fileName</span> <span class="comment"># 将 awk 输出的信息重定向到 file.txt 中</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>awk 的一般使用方法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'RegexPattern&#123;command&#125;'</span> srcFile</span><br></pre></td></tr></table></figure></p>
<p>‘ ‘ 内表示正则表达式+命令，如以下命令找出文件 time0 中以 “9”开头的行，并且输出到 file.txt 文件中。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'/^90/&#123;print&#125;'</span> time0 &gt;&gt; file.txt</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/uploads/avatar.jpg" alt="LanceXiong">
          <p class="site-author-name" itemprop="name">LanceXiong</p>
           
              <p class="site-description motion-element" itemprop="description">Recording my study.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LanceXiong</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Drelang.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
